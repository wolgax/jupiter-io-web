<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://jup.ag/favicon-96x96.png">
  <title>Jupiter Trade Widget</title>
  <script src="https://plugin.jup.ag/plugin-v1.js" data-preload defer></script>
  <style>
    :root {
      --jupiter-plugin-primary: 199, 242, 132;
      --jupiter-plugin-background: 11, 14, 19;
      --jupiter-plugin-primary-text: 232, 249, 255;
      --jupiter-plugin-warning: 251, 191, 36;
      --jupiter-plugin-interactive: 33, 42, 54;
      --jupiter-plugin-module: 16, 23, 31;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background-color: #0b0e13;
      color: #e8f9ff;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
    }
	
    a, a:hover, h2 {
      color: #c7f284;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 350px;
      max-width: 100%;
      position: relative;
      z-index: 1;
    }

    .top-bar {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #mintInput {
      flex-grow: 1;
      padding: 9px;
      border-radius: 8px;
      border: none;
      background-color: #10171f;
      color: #f0f0f0;
      text-align: center;
      font-size: 9.5px;
      cursor: pointer;
      opacity: 0.4;
      margin-left: 4px;
    }

    #jupiter-plugin {
      width: 100%;
      min-height: 500px;
      background-color: transparent;
      box-sizing: border-box;
    }

    .inputs {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }

    .form-group {
      display: flex;
      width: 100%;
    }

    .amount-buttons {
      gap: 10px;
      margin-top: -65px;
	  justify-content: center;
    }

    .amount-buttons button {
      flex: 0 0 60px;
      padding: 9px;
      border-radius: 8px;
      border: none;
      background-color: #1a2230;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .amount-buttons button:hover {
      background-color: #2a3350;
    }

    .icon-btn {
      background-color: #1a2230;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.12s ease;
    }

    .icon-btn:active {
      transform: scale(1.06);
    }

    .icon-btn img {
      width: 15px;
      height: 15px;
      pointer-events: none;
    }

    /* Popup */
	.popup {
	  position: fixed;
	  top: 50%;
	  left: 50%;
	  transform: translate(-50%, -50%);
	  background: #1a1f29;
	  color: #c7f284;
	  padding: 14px 18px;
	  border-radius: 12px;
	  box-shadow: 0 4px 15px rgba(0,0,0,0.4);
	  display: none;

	  /* вот тут меняем */
	  max-width: 400px;      /* шире */
	  width: 70%;            /* адаптивность под маленький экран */
	  max-height: 70vh;      /* ограничиваем по высоте */
	  overflow-y: auto;      /* прокрутка если текста слишком много */

	  text-align: justify;
	  font-size: 14px;
	  z-index: 1001;
	}

    .popup.active {
      display: block;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(6px);
      z-index: 1000;
      display: none;
    }

    .overlay.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>

  <div class="container">
    <div class="top-bar">
      <input type="text" id="mintInput" readonly>
      <div id="faqBtn" class="icon-btn">
        <img alt="faq" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjN2YyODQiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1iZWxsLWljb24gbHVjaWRlLWJlbGwiPjxwYXRoIGQ9Ik0xMC4yNjggMjFhMiAyIDAgMCAwIDMuNDY0IDAiLz48cGF0aCBkPSJNMy4yNjIgMTUuMzI2QTEgMSAwIDAgMCA0IDE3aDE2YTEgMSAwIDAgMCAuNzQtMS42NzNDMTkuNDEgMTMuOTU2IDE4IDEyLjQ5OSAxOCA4QTYgNiAwIDAgMCA2IDhjMCA0LjQ5OS0xLjQxMSA1Ljk1Ni0yLjczOCA3LjMyNiIvPjwvc3ZnPg=="/>
      </div>
      <div id="infoBtn" class="icon-btn">
        <img alt="info" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjN2YyODQiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1zaGllbGQtY2hlY2staWNvbiBsdWNpZGUtc2hpZWxkLWNoZWNrIj48cGF0aCBkPSJNMjAgMTNjMCA1LTMuNSA3LjUtNy42NiA4Ljk1YTEgMSAwIDAgMS0uNjctLjAxQzcuNSAyMC41IDQgMTggNCAxM1Y2YTEgMSAwIDAgMSAxLTFjMiAwIDQuNS0xLjIgNi4yNC0yLjcyYTEuMTcgMS4xNyAwIDAgMSAxLjUyIDBDMTQuNTEgMy44MSAxNyA1IDE5IDVhMSAxIDAgMCAxIDEgMXoiLz48cGF0aCBkPSJtOSAxMiAyIDIgNC00Ii8+PC9zdmc+"/>
      </div>
    </div>

    <div id="jupiter-plugin"></div>

    <div class="inputs">
      <div class="form-group amount-buttons">
        <button id="btn1">0.05</button>
        <button id="btn2">0.1</button>
        <button id="btn3">0.5</button>
        <button id="btnEdit">⚙️</button>
      </div>
    </div>
  </div>

  <div id="faqPopup" class="popup">
    <h2>Notification</h2>
	<p>This popup will display sources related to the development of the extension and website bridge, discounts, and other announcements. Only the sources explicitly listed here shall be deemed official. Any other sources are not official and may be misleading. For further information, please refer to the Frequently Asked Questions.</p>
	<p><a href="https://">FAQ</a> | <a href="https://">Github</a> | <a href="https://">Telegram</a></p>
  </div>

  <div id="infoPopup" class="popup">
    <h2>Privacy</h2>
	<p>This website interacts directly with the Jupiter platform and does not collect, store, or process login credentials, passwords, or any other confidential or sensitive information. This process is handled entirely on the Jupiter side.</p>
	<p>The website functions as a simple bridge with low transaction fees between the extension and Jupiter, as developing an extension capable of interacting with multiple websites (terminal - extension - jupiter) is technically hard. You may consider using a disposable (burner) wallet through your cryptocurrency wallet, which removes the need for confirmation before each transaction.</p>
	<p>For additional details about your privacy please refer to <a href="https://support.jup.ag/hc/en-us/p/privacy-policy">Jupiter’s Privacy Policy</a></p>
  </div>

  <script>
    const DEFAULT_MINT = "So11111111111111111111111111111111111111112";
    const DEFAULT_SOL = 1;
    const DEBOUNCE_MS = 350;
    let lastApplied = { mint: null, amount: null };
    let debounceTimer = null;

    const container = document.querySelector('.container');
    const overlay = document.getElementById('overlay');
    const mintEl = document.getElementById("mintInput");
    const btns = ["btn1","btn2","btn3"].map(id => document.getElementById(id));
    const btnEdit = document.getElementById("btnEdit");

    function loadButtonValues() {
      return btns.map((btn, idx) => {
        const stored = localStorage.getItem("btnValue" + idx);
        if (stored !== null) btn.textContent = stored;
        return parseFloat(btn.textContent);
      });
    }

    function saveButtonValues(values) {
      values.forEach((val, idx) => {
        localStorage.setItem("btnValue" + idx, val);
        btns[idx].textContent = val;
      });
    }

    function solToLamports(solAmount) {
      return Math.floor(Number(solAmount) * 1_000_000_000).toString();
    }

    function readInputs(amount) {
      const mint = (mintEl.value || "").trim() || DEFAULT_MINT;
      const amountFixed = Number.isFinite(amount) ? amount : DEFAULT_SOL;
      return { mint, amount: amountFixed };
    }

    function updateURL(mint, amount) {
      const p = new URLSearchParams();
      p.set("CA", mint);
      p.set("Amount", String(amount));
      history.replaceState(null, "", `${location.pathname}?${p.toString()}`);
    }

    function scheduleReinit(amount) {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const { mint, amount: amt } = readInputs(amount);
        if (mint === lastApplied.mint && amt === lastApplied.amount) return;

        updateURL(mint, amt);

        ensureJupiterReady().then(() => {
          window.Jupiter.init({
            displayMode: "integrated",
            integratedTargetId: "jupiter-plugin",
            containerStyles: { height: "430px", overflow: "hidden" },
            branding: { name: "Jupiter's Io" },
            formProps: {
              initialAmount: solToLamports(amt),
              initialInputMint: DEFAULT_MINT,
              initialOutputMint: mint,
              /*referralAccount: "7nwBzLE2cw5YvWZGrqaNEgELNHtAkGGaNSAnmySUE9KN",
              referralFee: 50*/
            }
          });
          lastApplied = { mint, amount: amt };
        });
      }, DEBOUNCE_MS);
    }

    function ensureJupiterReady() {
      if (window.Jupiter) return Promise.resolve();
      return new Promise(resolve => {
        const i = setInterval(() => {
          if (window.Jupiter) {
            clearInterval(i);
            resolve();
          }
        }, 50);
      });
    }

    function initFromURL() {
      const params = new URLSearchParams(location.search);
      const urlMint = params.get("CA");
      const urlAmount = parseFloat(params.get("Amount"));
      mintEl.value = urlMint || DEFAULT_MINT;
      const values = loadButtonValues();
      const amount = Number.isFinite(urlAmount) ? urlAmount : values[0];
      scheduleReinit(amount);
    }

    mintEl.addEventListener("click", () => mintEl.select());
    btns.forEach(btn => btn.addEventListener("click", () => scheduleReinit(parseFloat(btn.textContent))));
    btnEdit.addEventListener("click", () => {
      const newValues = btns.map((btn, idx) =>
        prompt(`Enter a new value for the button №${idx+1}: (only numbers and dot)`, btn.textContent) || btn.textContent
      );
      saveButtonValues(newValues);
    });

    window.addEventListener("load", initFromURL);

    const faqBtn = document.getElementById("faqBtn");
    const infoBtn = document.getElementById("infoBtn");
    const faqPopup = document.getElementById("faqPopup");
    const infoPopup = document.getElementById("infoPopup");

    function closePopups() {
      faqPopup.classList.remove("active");
      infoPopup.classList.remove("active");
      overlay.classList.remove("active");
    }

    function togglePopup(popup) {
      const isActive = popup.classList.contains("active");
      closePopups();
      if (!isActive) {
        popup.classList.add("active");
        overlay.classList.add("active");
      }
    }

    faqBtn.addEventListener("click", e => { e.stopPropagation(); togglePopup(faqPopup); });
    infoBtn.addEventListener("click", e => { e.stopPropagation(); togglePopup(infoPopup); });
    document.addEventListener("click", closePopups);
    [faqPopup, infoPopup].forEach(p => p.addEventListener("click", e => e.stopPropagation()));
  </script>
</body>
</html>

