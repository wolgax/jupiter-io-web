<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JUPITER'S IO WEB</title>
  <script src="https://plugin.jup.ag/plugin-v1.js" data-preload defer></script>
  <style>
	:root {
		--jupiter-plugin-primary: 199, 242, 132;
		--jupiter-plugin-background: 11, 14, 19;
		--jupiter-plugin-primary-text: 232, 249, 255;
		--jupiter-plugin-warning: 251, 191, 36;
		--jupiter-plugin-interactive: 33, 42, 54;
		--jupiter-plugin-module: 16, 23, 31;
	  }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background-color: #0b0e13;
      color: white;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
	  -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
	
	a {
	  color: #c7f284;
	}
	
	a:hover {
	  color: #c7f284;
	}
	
    .container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 350px;
      max-width: 100%;
    }

    #jupiter-plugin {
      width: 100%;
      min-height: 500px;
      background-color: transparent;
      box-sizing: border-box;
    }

    .inputs {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 97%;
    }

    .form-group {
      display: flex;
      width: 100%;
    }

    input {
      width: 100%;
      padding: 9px;
      border-radius: 8px;
      border: none;
      background-color: #10171f;
      color: #f0f0f0;
      text-align: center;
      font-size: 12.5px;
      box-sizing: border-box;
      cursor: pointer;
      opacity: 0.4;
    }

    .amount-buttons {
      display: flex;
      gap: 10px;
    }

    .amount-buttons button {
      flex: 0 0 60px;
      padding: 9px;
      border-radius: 8px;
      border: none;
      background-color: #1a2230;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .amount-buttons button:hover {
      background-color: #2a3350;
    }

    .bottom-bar {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 6px;
    }

    .icon-btn {
      background-color: #1a2230;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.12s ease;
    }

    .icon-btn:active {
      transform: scale(1.06);
    }

    .icon-btn img {
      width: 22px;
      height: 22px;
      pointer-events: none;
    }

    .popup {
      position: fixed;
      bottom: 76px;
      left: 50%;
      transform: translateX(-50%);
      background: #1a1f29;
      color: #c7f284;
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      display: none;
      max-width: 280px;
      text-align: center;
      font-size: 14px;
      z-index: 9999;
	  text-align: justify;
    }

    .popup.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="jupiter-plugin"></div>

    <div class="inputs">
      <div class="form-group amount-buttons">
        <button id="btn1">0.1</button>
        <button id="btn2">0.2</button>
        <button id="btn3">0.3</button>
        <button id="btn5">5</button>
        <button id="btnEdit">⚙️</button>
      </div>
      <div class="form-group">
        <input type="text" id="mintInput" readonly />
      </div>
    </div>

    <div class="bottom-bar">
      <div id="faqBtn" class="icon-btn">
        <img alt="faq" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjN2YyODQiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1jaXJjbGUtcXVlc3Rpb24tbWFyay1pY29uIGx1Y2lkZS1jaXJjbGUtcXVlc3Rpb24tbWFyayI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48cGF0aCBkPSJNOS4wOSA5YTMgMyAwIDAgMSA1LjgzIDFjMCAyLTMgMy0zIDMiLz48cGF0aCBkPSJNMTIgMTdoLjAxIi8+PC9zdmc+" />
      </div>
      <div id="infoBtn" class="icon-btn">
        <img alt="info" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjN2YyODQiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1zaGllbGQtY2hlY2staWNvbiBsdWNpZGUtc2hpZWxkLWNoZWNrIj48cGF0aCBkPSJNMjAgMTNjMCA1LTMuNSA3LjUtNy42NiA4Ljk1YTEgMSAwIDAgMS0uNjctLjAxQzcuNSAyMC41IDQgMTggNCAxM1Y2YTEgMSAwIDAgMSAxLTFjMiAwIDQuNS0xLjIgNi4yNC0yLjcyYTEuMTcgMS4xNyAwIDAgMSAxLjUyIDBDMTQuNTEgMy44MSAxNyA1IDE5IDVhMSAxIDAgMCAxIDEgMXoiLz48cGF0aCBkPSJtOSAxMiAyIDIgNC00Ii8+PC9zdmc+" />
      </div>
    </div>
  </div>

  <div id="faqPopup" class="popup">
    Similar to Jupiter's moon Io, this site functions as a satellite platform for the Jupiter One Touch Trade. It can be accessed at <a href="https://github.com/Hidden-Seeds/jupiter-one-touch-trade">github</a>
  </div>
  <div id="infoPopup" class="popup">
    This website interacts directly with the Jupiter platform and does not collect, store, or process login credentials, passwords, or any other sensitive personal information. Users are strongly advised to use burner wallets within their cryptocurrency wallets. For more information, please refer to <a href="https://dev.jup.ag/docs/misc/privacy-policy">Jupiter Privacy Policy</a>
  </div>

  <script>
    const DEFAULT_MINT = "So11111111111111111111111111111111111111112";
    const DEFAULT_SOL = 1;
    const DEBOUNCE_MS = 350;

    let lastApplied = { mint: null, amount: null };
    let debounceTimer = null;

    const mintEl = document.getElementById("mintInput");
    const btns = [ "btn1","btn2","btn3","btn5" ].map(id => document.getElementById(id));
    const btnEdit = document.getElementById("btnEdit");

    function loadButtonValues() {
      return btns.map((btn, idx) => {
        const stored = localStorage.getItem("btnValue" + idx);
        if (stored !== null) btn.textContent = stored;
        return parseFloat(btn.textContent);
      });
    }

    function saveButtonValues(values) {
      values.forEach((val, idx) => {
        localStorage.setItem("btnValue" + idx, val);
        btns[idx].textContent = val;
      });
    }

    function solToLamports(solAmount) {
      return Math.floor(Number(solAmount) * 1_000_000_000).toString();
    }

    function readInputs(amount) {
      const mint = (mintEl.value || "").trim() || DEFAULT_MINT;
      const amountFixed = Number.isFinite(amount) ? amount : DEFAULT_SOL;
      return { mint, amount: amountFixed };
    }

    function updateURL(mint, amount) {
      const p = new URLSearchParams();
      p.set("CA", mint);
      p.set("Amount", String(amount));
      history.replaceState(null, "", `${location.pathname}?${p.toString()}`);
    }

    function scheduleReinit(amount) {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const { mint, amount: amt } = readInputs(amount);
        if (mint === lastApplied.mint && amt === lastApplied.amount) return;
        updateURL(mint, amt);
        ensureJupiterReady().then(() => {
          window.Jupiter.init({
            displayMode: "integrated",
            integratedTargetId: "jupiter-plugin",
            containerStyles: { height: "500px" },
            branding: { name: "Jupiter's Io" },
            formProps: {
              initialAmount: solToLamports(amt),
              initialInputMint: DEFAULT_MINT,
              initialOutputMint: mint,
            }
          });
          lastApplied = { mint, amount: amt };
        });
      }, DEBOUNCE_MS);
    }

    function ensureJupiterReady() {
      if (window.Jupiter) return Promise.resolve();
      return new Promise(resolve => {
        const i = setInterval(() => {
          if (window.Jupiter) { clearInterval(i); resolve(); }
        }, 50);
      });
    }

    function initFromURL() {
      const params = new URLSearchParams(location.search);
      const urlMint = params.get("CA");
      const urlAmount = parseFloat(params.get("Amount"));
      mintEl.value = urlMint || DEFAULT_MINT;
      const values = loadButtonValues();
      const amount = Number.isFinite(urlAmount) ? urlAmount : values[0];
      scheduleReinit(amount);
    }

    mintEl.addEventListener("click", () => mintEl.select());
    btns.forEach(btn => btn.addEventListener("click", () => scheduleReinit(parseFloat(btn.textContent))));
    btnEdit.addEventListener("click", () => {
      const newValues = btns.map((btn, idx) => prompt(`Enter a new value for the button №${idx+1}: (only numbers and dot)`, btn.textContent) || btn.textContent);
      saveButtonValues(newValues);
    });

    window.addEventListener("load", initFromURL);

    const faqBtn = document.getElementById("faqBtn");
    const infoBtn = document.getElementById("infoBtn");
    const faqPopup = document.getElementById("faqPopup");
    const infoPopup = document.getElementById("infoPopup");

    function closePopups() {
      faqPopup.classList.remove("active");
      infoPopup.classList.remove("active");
    }

    function togglePopup(popup) {
      popup.classList.toggle("active");
      if (popup.classList.contains("active")) {
        [faqPopup, infoPopup].filter(p => p !== popup).forEach(p => p.classList.remove("active"));
      }
    }

    faqBtn.addEventListener("click", e => { e.stopPropagation(); togglePopup(faqPopup); });
    infoBtn.addEventListener("click", e => { e.stopPropagation(); togglePopup(infoPopup); });
    document.addEventListener("click", closePopups);
    [faqPopup, infoPopup].forEach(p => p.addEventListener("click", e => e.stopPropagation()));
  </script>
</body>
</html>
